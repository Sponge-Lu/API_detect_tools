# 更新日志

所有对本项目的显著变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，并且本项目遵循 [Semantic Versioning](https://semver.org/spec/v2.0.0.html)。

## [v2.1.13]

### 优化
- **LDC 查看交易记录**：改用系统默认浏览器打开 credit.linux.do，而非 Electron 内置窗口

---

## [v2.1.12]

### 新增
- **iOS 风格 UI 重构**：全面采用 Apple Human Interface Guidelines 设计语言
  - 新增 iOS 设计系统 CSS 变量（颜色、字体、间距、圆角、阴影、模糊）
  - 新增 IOSButton 组件（Primary/Secondary/Tertiary 变体，支持 ref 转发）
  - 新增 IOSCard 组件（毛玻璃背景、展开/收起动画）
  - 新增 IOSInput/IOSSearchInput 组件（聚焦状态、密码显示切换）
  - 新增 IOSModal 组件（缩放+淡入淡出动画、焦点陷阱）
  - 新增 IOSTable 组件（分组样式、交错淡入动画）
  - 新增 IOSIcon 组件（统一 1.5px stroke-width、标准尺寸）
  - 新增 8px 网格间距系统（所有间距值为 4px 的倍数）
  - 新增响应式布局系统（最小 1024x768，响应式间距和字体）
  - 新增性能优化系统（GPU 加速、will-change、高性能动画）
  - 新增无障碍性系统（焦点指示器、键盘导航、ARIA 属性）
  - 新增 prefers-reduced-motion 支持

### 优化
- **窗口尺寸调整**：默认窗口 1400x900，最小窗口 1200x700，解决水平滚动条问题
- **站点卡片样式**：移除渐变背景色，使用纯色背景 + 边框分隔，更符合 iOS 设计风格
- **二级卡片样式**：优化 SiteCardDetails 展开详情区域的 iOS 风格
- **CLI 操作按钮组**：使用 iOS 风格圆角、边框、背景色和点击效果
- **CLI 配置对话框**：统一 CLI 开关和类型选择样式，优化表单元素和配置预览
- **图标线条宽度**：从 2px 改为 1.5px，更接近 SF Symbols 风格
- **装饰性背景**：减弱页面装饰性背景效果（降低渐变光晕不透明度）
- **代码清理**：移除未使用的导入和变量
- **站点卡片拖拽性能**：优化拖拽时的渲染性能
  - 使用 useRef 跟踪 dragOverIndex，避免重复状态更新
  - SiteCard 组件添加 React.memo 和自定义比较函数
  - 只有受影响的卡片才会重新渲染
  - IOSCard 拖拽状态添加 will-change GPU 加速提示
- **iOS 原生风格优化**：全面优化 UI 组件以符合 iOS 原生设计规范

### 修复
- **双滚动条问题**：修复右侧出现两个垂直滚动条的问题
- **CLI 配置对话框夜晚模式**：修复代码预览区域在深色模式下颜色对比度不足的问题，使用统一的深色代码块背景
- **LDC刷新**：登录和主界面的刷新按钮刷新所有数据
- **拖拽布局跳动**：修复拖拽时边框导致的布局跳动问题并支持自动滚动页面

### 移除
- **主题切换过渡系统**：移除 300ms 主题切换过渡效果，主题切换现在立即生效

---

## [v2.1.11]

### 新增
- **多平台打包支持**：支持 Windows、macOS、Linux 三平台自动化构建
  - 新增 GitHub Actions 工作流，推送 tag 自动构建并发布
  - 支持手动触发构建
  - 统一使用 `build/icon.png` 作为图标源，自动转换为各平台格式
  - 新增打包脚本：`dist:win`、`dist:mac`、`dist:linux`
- **电源管理**：新增 `powerManager` 模块，阻止系统在应用运行时进入休眠/睡眠状态 -- 未验证
  - 使用 Electron `powerSaveBlocker` API
  - 采用 `prevent-display-sleep` 模式，同时阻止显示器和系统休眠
  - 特别适用于远程桌面环境，防止系统误判无用户活动而休眠
  - 应用启动时自动启用，退出时自动停止

---

## [v2.1.10]

### 新增
- **站点检测状态持久化**：站点检测状态（成功/失败）和错误信息在应用重启后能正确恢复
  - 扩展 `cached_data` 接口，添加 `status` 和 `error` 字段
  - 检测成功时保存 `status: '成功'`，失败时保存 `status: '失败'` 和错误信息
  - 应用启动时从缓存读取状态，向后兼容（无 status 字段时默认为 '成功'）
- **LDC比例列排序**：站点列表的"LDC比例"列现在支持点击排序
- **Linux Do Credit 积分监控**：
  - 新增完整用户信息展示：头像、昵称、信任等级徽章
  - 新增收支信息：总收入、总支出、可用余额
  - 新增支付信息：支付评分、支付等级、剩余配额、每日限额
  - 可折叠的详情面板，展示每日收支统计和交易记录
  - 使用网格布局优化核心积分信息展示
  - 展开详情显示三栏布局：交易记录、收入统计、支出统计
- **LDC 充值功能**：在 Credit 面板展开详情底部新增快捷充值入口
  - 一行紧凑布局：标题 | 站点选择 | 金额输入 | 所需积分 | 充值按钮
  - 选择支持 LDC 支付的站点，输入充值金额（整数，最小1）
  - 自动计算所需 LDC 积分（充值金额 × 兑换比例）
  - 余额不足时显示警告
  - 点击充值按钮后在浏览器中打开支付页面
- **站点 LDC 支付检测**：站点检测时自动检测是否支持 Linux Do Credit 支付
  - 调用 `/api/user/topup/info` 检查 `pay_methods` 数组中是否包含 LDC 支付方式
  - 支持多种 LDC 支付名称匹配（Linuxdo Credit、LinuxDo Credit、Linux Do Credit、LDC 等）
  - 调用 `/api/user/amount`（POST 方法）获取 LDC 兑换比例
  - 站点列表新增 "LDC充值比例" 列，显示支付比例（如 "0.60"），不支持时显示 "-"
  - LDC 支付信息持久化到站点的 `cached_data` 中，重启应用后自动加载显示
- **New API 签到功能支持**：兼容 New API 类型站点的签到功能
  - 签到检测：同时支持 `check_in_enabled`（Veloera）和 `checkin_enabled`（New API）字段
  - 签到状态：支持 `/api/user/check_in_status`（Veloera）和 `/api/user/checkin?month=YYYY-MM`（New API）两种接口
  - 执行签到：支持 `/api/user/check_in`（Veloera）和 `/api/user/checkin`（New API）两种端点
  - 奖励解析：兼容 `reward`（Veloera）和 `quota_awarded`（New API）两种响应格式
  - 签到失败时根据站点类型打开对应的手动签到页面（Veloera: /console, New API: /console/personal）
- **签到图标悬停提示**：New API 类型站点签到图标悬停显示签到统计
  - 已签到状态：显示"今日已签到 +$0.0994 | 本月 2 次"
  - 可签到状态：显示"点击签到 | 本月 1 次"
  - 无统计数据时显示默认文本
- **签到统计数据获取**：签到成功后自动获取当月签到统计
  - 调用 `GET /api/user/checkin?month=YYYY-MM` 获取签到记录
  - 从 `stats.records` 中查找今日签到金额
  - 从 `stats.checkin_count` 获取当月签到次数
- **浏览器模式签到回退**：axios 请求被 Cloudflare 拦截时自动切换到浏览器模式重试

### 优化
- **Codex 配置生成器**：中文站点名称自动转换为拼音
  - 使用 pinyin-pro 库将中文转换为拼音（如 "公益站" → "Gongyizhan"）
  - 移除其他非英文字符，确保提供商名称仅包含英文字母
  - 去掉配置模板中的冗余注释
- **Credit 面板 UI 优化**：
  - 紧凑视图只显示"今日积分变化"差值
  - 展开视图积分信息分两组显示：Linux Do 社区积分（基准值/当前分/今日积分变化）和 Linux Do Credit 积分（收入/支出/可用）
  - 统计卡片采用紧凑布局，高度自适应内容
  - 收入/支出统计使用水平条形图，日期和数值在条形上方（日期靠左，数值靠右）
  - 只显示最近5天的统计数据
  - 支付信息区使用四列布局显示支付评分、支付等级、剩余配额、每日限额
  - 活动卡片"查看全部"链接移到更新时间后面，使用蓝色字体
- **Credit 面板设置简化**：移除设置按钮，将自动刷新开关和间隔设置直接显示在面板底部
- **代码精简**：删除未使用的 CreditPanel 组件，只保留 CreditPanelCompact
- **Linux Do Credit 数据加载策略**：优化登录时的数据获取流程
  - 登录时在 credit.linux.do 页面一次性获取所有数据（用户信息、每日统计、交易记录）
  - 避免跨域问题：在导航到 linux.do 之前完成 credit.linux.do API 调用
  - 数据缓存到本地，展开详情时直接使用缓存数据，无需重新获取
  - 新增 IPC 通道支持获取缓存的每日统计和交易记录
- **UI 布局调整**：
  - 移除站点分组标签的提示文字，"新建分组"按钮移到所有分组标签最后
  - "搜索可用模型（全局）"移到右侧区域
  - 移除"站点操作"文字，移除顶部工具栏的"检测所有站点"按钮
  - 检测所有站点刷新按钮移到站点表头，对齐到单个站点刷新按钮正上方
  - 展开全部按钮移到站点表头，对齐到单个站点展开按钮正上方
  - CLI 配置状态面板移到"添加站点/恢复站点"行的最右侧
  - Credit 面板移到 Header 设置按钮左侧，展开后使用 fixed 定位确保显示在 UI 最上层
  - 未登录时 Credit 面板显示"Linux Do Credit"而非"Credit"
  - 移除一级卡片的复制 URL 按钮
  - 二级卡片（展开详情）顶部新增站点 URL 和 Access Token 显示
  - URL 和 Access Token 显示在同一行，各带复制按钮
  - Access Token 脱敏显示（前8位 + **** + 后8位），支持显示/隐藏切换
- **站点刷新浏览器模式优化**：当已进入浏览器模式并拿到共享页面后，后续端点直接在浏览器上下文中请求，减少重复的“axios → browser”回退带来的延迟与噪音日志。
- **共享页面并发稳定性**：对同一 Puppeteer `Page` 的 `page.evaluate` 增加队列串行化，降低偶发 “Execution context destroyed/Target closed” 风险。
- **UI 布局调整**：签到图标放在加油站图标后面，保持图标顺序一致性

### 修复
- **formatDateToMMDD 函数**：修复对无效日期格式的处理，使用正则验证确保输入格式正确
- **Linux Do Credit 登录问题**：修复 Cloudflare 保护导致的"登录已过期"错误
  - 使用浏览器环境 (`page.evaluate`) 获取 API 数据，绕过 Cloudflare `cf_clearance` 验证
  - 登录成功后在同一浏览器会话中直接获取积分数据
  - 支持导航到 `linux.do` 获取 `gamification_score`（当前分）
  - 修复打开两个浏览器页面的问题，现在只打开一个页面
- **Credit 面板层级问题**：修复展开的 Credit 面板被站点列表遮挡的问题
- **LDC 充值功能修复**：
  - 修复充值时"站点认证 token 不可用"错误，改用浏览器模式进行充值
  - 修复充值时"支付方式不存在"错误，将参数名从 `topup_method` 改为 `payment_method`
  - 修复支付页面 404 错误，改用 POST 表单提交到支付网关
  - 修复登录检测问题，使用 localStorage 检测登录状态（与站点刷新逻辑一致）
  - 修复支付页面过早关闭问题，成功跳转到支付页面后保持浏览器打开
  - 添加 `New-Api-User` header 支持站点 API 认证
- **Codex 官方 API Key 检测**：修正官方 API Key 判断逻辑，从 `sk-` 改为 `sk-proj-` 前缀
  - 很多中转站也使用 `sk-xxx` 格式的 API Key，但只有 `sk-proj-` 开头的才是 OpenAI 官方 API Key
  - 修复使用中转站时错误显示"官方 API"的问题
- **Linux Do Credit 积分刷新**：修复访问 linux.do 时遇到 Cloudflare 验证（403）导致无法获取用户积分的问题
  - 将 HTTP 直接请求改为浏览器环境请求，绕过 Cloudflare 人机验证
  - 直接导航到 linux.do 获取数据，不再先尝试跨域请求
- **应用重启后登录状态**：修复重启应用后需要重新登录才能显示数据的问题
  - 如果有缓存的 cookies，直接认为已登录，显示缓存数据
  - 只有在实际获取数据失败时才更新登录状态
- **刷新间隔显示**：修复自动刷新间隔显示单位错误（从"秒"改为"分钟"）
- **刷新间隔同步**：修复配置加载后输入框显示值与实际配置不一致的问题
- **LDC 兑换比例接口 403**：`/api/user/amount`（POST）在需要站点会话/Cookie 时自动回退到浏览器模式，请求行为与其它端点保持一致。
- **签到图标状态更新**：修复签到成功后图标没有变灰的问题
  - 签到成功后更新 `lastRefresh` 时间戳，确保 `isToday` 判断正确
  - 图标现在会正确显示为灰色已签到状态
- **Linux Do Credit 登录优化**：
  - 修复登录检测逻辑，不再依赖特定的 session cookie 名称，改为通过 API 响应验证登录状态
  - 登录时显示 toast 提示用户在浏览器中完成登录
  - 优化 linux.do 积分获取，直接导航到 linux.do 页面避免跨域问题
  - 添加 Cloudflare 验证等待和重试机制，解决 403 错误
  - 获取每日统计和交易记录前添加等待时间，确保 Cloudflare 验证完全通过

## [v2.1.9]

### 新增
- **窗口关闭行为选择**：点击关闭按钮时可选择退出或最小化到托盘
- **Codex 官方 API Key 检测**：正确识别 OpenAI 官方 API Key（以 `sk-` 开头）
  - 使用官方 API Key 登录时，配置检测显示"官方 API"而非"站点配置"
  - 官方 API Key 优先级高于 config.toml 中的站点配置
  - 支持从 auth.json 和环境变量检测官方 API Key
  - 首次关闭时弹出选择对话框
  - 支持"记住我的选择"功能
  - 系统托盘图标支持（点击恢复窗口、右键菜单）
  - 设置面板中可随时更改偏好（每次询问/直接退出/最小化到托盘）
- **CLI 配置检测功能**：自动检测本地 CLI 工具的配置状态
  - 支持检测 Claude Code、Codex、Gemini CLI 三种 CLI 工具
  - 显示配置来源类型：managed（本应用管理）、other（其他来源）、unconfigured（未配置）
  - Header 区域显示 CLI 配置状态面板，支持展开查看详情
  - 支持手动刷新检测结果
- **Codex 双 API 测试**：同时测试 Chat Completions API 和 Responses API
  - 测试结果显示详细信息：`chat: ✓/✗, responses: ✓/✗`
  - 鼠标悬停 Codex 图标显示详细测试结果
  - 测试完成后自动更新配置文件中的 `wire_api` 值
  - 根据测试结果自动选择最佳 API（优先 responses，其次 chat）
  - 配置文件包含测试结果注释
- **Gemini CLI 双端点测试**：同时测试 Native 和 Proxy 端点
  - Native: Google 原生格式 (`/v1beta/models/{model}:generateContent`) - Gemini CLI 实际使用此格式
  - Proxy: OpenAI 兼容格式 (`/v1/chat/completions`) - 仅供参考
  - 测试结果显示详细信息：`native: ✓/✗, proxy: ✓/✗`
  - 鼠标悬停显示详细状态和使用建议
  - 测试完成后弹窗提示测试结果和使用建议
  - 配置文件包含端点测试结果注释和说明
  - Gemini CLI 支持状态仅基于 Native 测试结果（因为 CLI 只使用原生格式）
- **分形多级索引系统**：https://github.com/Claudate/project-multilevel-index

### 改进
- **Toast 提示时间**：默认显示时间从 3 秒增加到 5 秒
- **CLI 配置优先级检测**：正确检测各 CLI 工具的有效配置
  - Codex：OAuth 登录优先于自定义 provider 配置（除非设置 `forced_login_method = 'api'`）
  - Codex：修复 OAuth 凭证检测，从 `auth.json` 的 `tokens` 字段检测登录状态
  - Gemini CLI：Google 登录/Vertex AI 优先于 base_url 配置
  - Claude Code：环境变量优先于 settings.json 配置
- **CLI 状态显示优化**：增加不同 CLI 之间的分隔线，显示更清晰

### 修复
- **CLI 配置检测刷新**：修复点击刷新后显示"未检测"的问题
  - 刷新时先清除后端缓存再重新检测
  - 站点列表从应用配置获取，而非检测结果
- **CLI 配置应用后自动刷新**：应用 CLI 配置后自动刷新检测状态
- **CLI 兼容性测试准确性**：改进 CLI 兼容性测试逻辑
  - 支持更灵活的模型名称匹配（如 `claude3`、`gpt4o`、`o1-preview` 等）
  - 改进响应验证：401/403/429 状态码表示 API 存在，400 + 特定错误类型也表示支持
  - 500 + 内容验证错误（如 `EMPTY_RESPONSE`）也表示 API 格式正确
  - Gemini CLI 测试支持 OpenAI 兼容格式（中转站常用）
- **CLI 测试结果持久化**：修复热重载和重启应用后 CLI 测试结果丢失的问题
  - 修复 `api-service.ts` 保存检测结果时覆盖 `cli_compatibility` 的问题
  - 修复 `configStore.ts` 更新站点时丢失 `cached_data` 的问题
- **应用配置弹框显示**：修复最后一个站点点击应用按钮时弹框显示不全的问题
  - 弹框自动检测空间，下方空间不足时向上展开
- **Codex OAuth 检测**：修复 Codex 账号登录后仍显示自定义站点的问题
  - 正确检测 auth.json 中的 tokens 字段来判断 OAuth 登录状态

---

## [v2.1.8]

### 修复
- **CLI 配置保存**：修复保存 CLI 配置后 `editedFiles` 为空导致测试失败的问题
  - 保存时自动生成配置文件内容（如果用户未手动编辑）
  - 优先级：手动编辑 > 已保存编辑 > 实时生成

---

## [v2.1.7]

### 新增
- **Gemini CLI 配置支持**：完整支持 Gemini CLI 配置生成和应用
  - Gemini CLI 默认启用
  - 支持生成 settings.json 和 .env 配置文件
  - 配置模板参考 `docs/cli_config_template/gemini_cli_config_template.md`
- **配置合并模式**：应用配置时支持合并和覆盖两种模式
  - 合并模式（默认）：保留现有配置，只更新相关项
  - 覆盖模式：完全替换现有配置文件
  - JSON 文件：深度合并，保留现有配置项
  - TOML 文件：合并顶级变量和 sections
  - .env 文件：只更新相关环境变量，保留其他变量
  - 避免覆盖用户的 MCP 服务器配置等自定义设置
- **配置重置功能**：配置预览区域新增"重置"按钮
  - 点击后弹出确认对话框，确认后恢复为默认生成的配置
  - 仅在有编辑内容时显示
- **统一 CLI 配置对话框**：合并原有的 CLI 配置和配置生成功能
  - CLI 开关区域：所有 CLI 类型在同一行显示，支持独立启用/禁用
  - 模型分离：测试使用模型和 CLI 使用模型分开配置
  - 实时配置预览：选择 API Key 和模型后自动生成配置，支持编辑
  - 配置模板：未选择配置时显示完整模板内容供参考
  - 代理设置：Claude Code 配置自动包含 HTTPS_PROXY 和 HTTP_PROXY
- **应用配置功能**：一键将配置写入本地文件
  - 应用弹出菜单：显示已配置的 CLI 列表（包括 Gemini CLI）
  - 配置文件写入：自动创建目录并写入配置文件
  - Claude Code 重启提醒：应用配置后提示用户重启 IDE

### 变更
- 移除 Chat 基础测试功能及相关代码
- Gemini CLI 从默认禁用改为默认启用

### 优化
- 移除独立的配置生成对话框，功能整合到统一配置对话框
- 配置预览窗口移除固定高度限制，显示完整内容

---

## [v2.1.6]

### 新增
- **CLI 兼容性测试**：检测站点是否支持 Claude Code、Codex、Gemini CLI 等工具
  - 支持单站点测试（需先配置 CLI 设置）
  - 站点卡片显示 CLI 兼容性图标（彩色=支持，深灰=不支持，浅灰=已配置待测试，非常淡=未配置）
  - 鼠标悬停显示详细状态和上次测试时间
  - 测试结果持久化保存，重启应用后自动恢复
- **CLI 配置对话框**：为每个站点配置 CLI 测试参数
  - 选择用于测试的 API Key
  - 选择用于测试的模型（Claude Code 只显示 claude* 模型，Codex 只显示 gpt* 模型，Gemini CLI 只显示 gemini* 模型）
  - 支持 Claude Code、Codex、Gemini CLI 三种类型
- **CLI 官方图标**：使用 lobehub.com/icons 官方 SVG 图标
  - Claude Code（Anthropic 官方 logo）
  - Codex（OpenAI 官方 logo，绿色）
  - Gemini CLI（Google Gemini 官方 logo）

### 修复
- **CLI 配置加载**：修复应用重启后 CLI 配置和测试结果不显示的问题
  - 兼容 `cached_data` 和站点根级别两种数据存储位置

---

## [v2.1.5]

### 优化
- **日志统计过滤**：今日消费、Token 使用量和请求次数统计现在只包含模型调用日志，排除系统日志和管理操作日志，统计数据更准确
- **"真·空数据"刷新提示**：与其他刷新操作保持一致，显示"数据已更新"或"数据无变化"，移除 toast 弹窗

### 新增
- **站点列表排序功能**：
  - 点击表头列标题可按该列排序（站点名、余额、今日消费、Token、请求数、RPM、TPM、模型数、更新时间）
  - 首次点击降序，再次点击升序，第三次点击取消排序
  - 当前排序列显示箭头图标（↓降序/↑升序）
  - 排序设置自动保存到 config.json，重启应用后自动恢复

### 优化
- **签到/加油站图标**：移除按钮文字，仅显示图标，界面更简洁
- **数值列颜色区分**：总Token、输入、输出、请求、RPM、TPM 列，值为0时颜色更淡，不为0时颜色加深

### 变更
- **站点状态显示优化**：状态列合并到站点名称前
  - 绿色圆点（带脉冲动画）= 在线
  - 红色圆点 = 离线
  - 灰色圆点 = 未检测
  - 错误码/超时紧凑显示在名称后
- **自动刷新改为站点独立控制**：
  - 从全局设置移除自动刷新选项
  - 每个站点有独立的自动刷新开关（Timer 图标）
  - 状态保存在站点配置中，持久化到 config.json
- **自动刷新间隔设置**：
  - 在站点编辑器中配置自动刷新开关和刷新间隔（最小 3 分钟）
  - 站点卡片上的刷新按钮可快速切换开关状态
  - 间隔时间持久化保存到站点配置
- **自动刷新定时器实现**：
  - 新增 `useAutoRefresh` hook 管理站点自动刷新定时器
  - 支持多站点并发刷新，互不干扰
  - 定时器在站点配置变更时自动更新（启用/禁用/间隔变化）
  - 组件卸载时自动清理所有定时器
- **Cloudflare 保护站点支持**：
  - 站点编辑器中提醒用户 CF 保护站点需保持浏览器开启
  - 有站点开启自动刷新时，检测完成后不自动关闭浏览器
- **移除禁用/启用按钮**：从站点操作中移除

### 优化
- **今日消费颜色**：消费为 0 时使用更浅的橙色，便于区分
- **列宽配置**：从 12 列减为 11 列，站点列宽增加以容纳状态图标
- **并发刷新结果更新**：修复多站点同时刷新时结果互相覆盖的问题

---

## [v2.1.4]

### 新增
- **"真·空数据"功能**：认证错误弹窗新增"真·空数据"按钮
  - 适用场景：站点管理员清空了模型列表，但 Token 仍然有效
  - 点击后强制获取数据（接受空数组），直接更新结果
  - 弹窗内提供"打开站点"链接，方便用户先确认数据状态再选择操作

### 优化
- **认证错误诊断**：改进认证错误处理，精确区分三种不同的认证问题
  - ⏰ 会话过期：返回成功但无数据时（Token 有效，Session 失效）
  - 🔑 Token 失效：返回 401 状态码时
  - 🚫 权限不足：返回 403 状态码时
- **错误提示优化**：认证错误对话框现在根据错误类型提供精确诊断和解决建议
- **批量检测体验**：认证错误不再阻塞检测流程
  - 移除检测到认证错误时立即弹窗的逻辑
  - 所有站点检测完成后统一提醒需要重新登录的站点
  - Cloudflare 浏览器模式正常工作，不受影响

### 修复
- **Turnstile 签到失败无弹窗**：修复签到返回"Turnstile token 为空"时未触发手动签到弹窗的问题
- **站点认证弹窗循环问题**：修复重新获取站点信息后仍然弹窗"站点认证需要更新"的问题
  - 移除"检测到会话过期时立即停止尝试其他端点"的错误优化
  - 所有端点都会被完整尝试，综合判断结果
  - 空数组响应（`{ success: true, data: [] }`）正确识别为 session 过期
  - 优先处理空响应，确保触发正确的认证错误弹窗
- **浏览器未关闭**：修复重新获取站点信息后浏览器窗口未自动关闭的问题
  - 站点初始化完成后（无论成功或失败）自动关闭浏览器
  - 编辑站点保存后自动刷新完成后也会尝试关闭浏览器
  - 使用安全的 `cleanup()` 方法，检查引用计数避免误关正在进行其他检测的浏览器
- **配置保存时序**：修复编辑站点保存后自动检测使用旧配置的问题
  - 添加 `await` 确保配置保存完成后再开始检测
  - 避免检测时使用过期的 access_token 导致认证错误
- **TLS 握手失败**：修复打包后某些站点（如 anyrouter.top）出现 `SSLV3_ALERT_HANDSHAKE_FAILURE` 错误的问题
  - 根因：Electron 打包后使用 BoringSSL（Chrome 的 SSL 库），支持的加密套件比开发环境的 OpenSSL 更少
  - 解决方案：创建统一 HTTP 客户端，打包环境自动使用 Electron `net` 模块（Chromium 网络栈）替代 axios
  - 新增 `src/main/utils/electron-fetch.ts` - Electron net 模块封装
  - 新增 `src/main/utils/http-client.ts` - 统一 HTTP 客户端（自动切换）

---

## [v2.1.3]

### 新增
- **软件更新检测**：支持在应用内检查软件更新
  - 启动时自动在后台检查更新（可在设置中关闭）
  - 手动检查更新功能
  - 同时显示最新正式版本和预发布版本
  - 预发布版本支持（Beta、Alpha 等）
  - 更新详情对话框，显示版本号、发布日期、更新说明
  - 一键跳转到下载页面
  - Header 区域显示更新提示徽章

### 修复
- **配置导出**：修复导出配置时加油站链接和签到信息字段可能缺失的问题
- **浏览器管理**：修复所有站点检测完成后浏览器未及时关闭的问题
  - 新增 `forceCleanup` 方法强制关闭浏览器，忽略引用计数
  - 检测完成后自动调用强制关闭
- **页面管理**：修复同一站点可能打开多个重复页面的问题
  - 改进页面清理逻辑，自动关闭同一域名的重复页面

---

## [v2.1.2]

### 新增
- **WebDAV 云端备份**：支持将配置备份到 WebDAV 云存储（坚果云、NextCloud、Synology NAS 等）
  - 配置 WebDAV 连接（服务器地址、用户名、密码、远程路径）
  - 连接测试功能
  - 上传备份（自动生成带时间戳的文件名）
  - 查看和管理云端备份列表
  - 从云端备份恢复配置
  - 自动清理旧备份（可配置最大备份数量）

### 修复
- 修复检测所有站点完成后按钮仍显示"检测中"的问题
- 修复 WebDAV 配置在进行其他操作（如拖拽站点）后丢失的问题

### 优化
- 优化夜晚模式下设置面板各区域的视觉区分度
- 优化夜晚模式下站点一级卡片与二级面板的对比度

---

## [v2.1.1]

### 新增
- **模型列表分页显示**：默认只显示前 50 个模型，点击"显示全部"加载更多，大幅提升展开全部站点时的渲染性能。
- **批量检测实时刷新**：并发检测时单站完成即刻更新 UI，不再等待全部结束。
- **UI优化**：表头使用和站点卡片一致的渐变色；用户分组图标改为按顺序显示的圆框数字（①②③...）。
- **登录提示与等待**：批量检测遇到未登录站点时，自动打开浏览器并弹窗提示用户登录，登录后可继续检测。
- **证书错误提示**：模型/余额接口遇到证书过期或不受信任（如 “Certificate has expired”）时，直接提示原因，避免长时间超时。
- **模型全局搜索栏**：全局搜索模型，隐藏没有该模型的站点。
- **UI调整**：站点一级卡片增加渐变色，在展开二级面板后更显眼；白天模式的签到标签文字对比度增加；夜晚模式下，最大并发数可以看到了。
- **全部站点展开/收起**：可以对所有站点卡片同时展开与收起，避免一个一个手动点击。
- **签到按钮自动恢复**：第二天签到按钮自动恢复成”签到“样式。

### 默认调整
- 超时默认 30 秒。
- 并发默认开启，最大并发默认 3（可在设置中调节 1–5）。

### 其他
- 调试端口随机化，减少固定端口被拦截/误报的概率。
- 取消隐藏/后台启动 Chrome，降低被杀软误报概率。

---

## [2.1.0] - 2025-12-02

### 新增
- **架构重构**：全面迁移至 Zustand 状态管理，降低组件耦合度，提升应用响应速度。
- **模块化服务**：拆分 IPC 处理器为独立的模块（config, theme, backup, token, detection），主进程逻辑更清晰。
- **自动备份系统**：配置文件和令牌数据自动备份到 `~/.api-hub-management-tools/`，并提供 GUI 界面支持从任意历史备份恢复。
- **备份恢复体验**：从备份恢复配置后立即加载数据，无需重启应用。
- **更新时间显示**：优化站点更新时间的显示逻辑，使用更人性化的格式（如“x天前”）。
- **配置导入导出**：支持 JSON 格式的完整配置导入导出，便于数据迁移。
- **Toast 通知**：引入全局 Toast 通知系统，提供更友好的操作反馈。
- **加载骨架屏**：在数据加载时显示骨架屏，提升视觉体验。

### 优化
- **性能提升**：引入 `RequestManager` 实现 API 请求去重与缓存，减少不必要的网络请求。
- **构建体积**：优化 Vite 配置与代码分割，显著减小应用体积。
- **错误处理**：统一了全链路的错误捕获与提示机制，确保异常情况有明确反馈。
- **代码规范**：落地 ESLint + Prettier + Husky 工作流，统一代码风格。
- **类型安全**：引入 Zod 进行运行时输入验证，强化 TypeScript 类型定义。

### 修复
- 修复了主进程中重复注册 IPC 处理器的问题。
- 修复了部分 API 请求头重复定义的问题。
- 移除了大量废弃的旧代码（如 ConfigManager, TokenStorage），精简代码库。

---

## [2.0.6] - [2.0.8]
- **忘记记录了**

---

## [2.0.5] - 2025-11-27

### 优化
- **智能添加站点**：简化添加流程，从 4 步减少为 2 步。点击“获取信息”后自动处理浏览器登录与检测。
- **状态反馈**：添加站点时实时显示操作状态（启动浏览器、等待 Cloudflare、等待登录等）。
- **登录检测**：增强了 Session 过期检测和页面导航重试机制。
- **界面布局**：优化站点编辑卡片，采用更紧凑的布局，提升信息密度。
- **签到体验**：签到失败后支持直接跳转到签到页面；优化了相关提示文案。

---

## [2.0.4] - 2025-11-26

### 新增
- **自定义弹窗**：使用美观的自定义弹窗替代系统原生 alert/confirm。
- **分组排序**：支持通过拖拽调整站点分组的顺序。
- **主题持久化**：修复了重启后主题设置丢失的问题，并解决了启动白屏闪烁。

### 优化
- **界面细节**：调整了字体大小和间距，提升整体可读性。
- **权限错误提示**：检测到 401/403 错误时，提供更明确的重新登录引导。
- **浏览器管理**：优化了会话清理逻辑，防止加载旧的历史页面。

---

## [2.0.3] - 2025-11-25

### 新增
- **站点分组管理**：支持创建、编辑、删除站点分组。
- **分组筛选**：支持按分组筛选站点列表。
- **拖拽分组**：支持将站点拖拽到分组标签进行快速分类。

### 修复
- 修复了配置文件加载时的部分逻辑错误。

---

## [2.0.2] - 2025-11-24

### 新增
- **API Key 管理增强**：支持在应用内直接删除 API Key，并兼容多种删除接口格式。
- **Cloudflare 兼容**：API Key 操作支持自动降级到浏览器模式，以绕过 Cloudflare 验证。

### 优化
- **刷新策略**：API Key 变更后仅刷新相关数据，不再强制全站刷新。

---

## [2.0.1] - 2025-11-20

### 新增
- **统计视图**：新增 Token 使用量（输入/输出/总量）、请求数、RPM/TPM 等统计指标。
- **列宽调整**：支持拖拽调整列表列宽，并自动保存偏好。
- **快捷操作**：在列表项中集成签到、复制、刷新等快捷按钮。

### 优化
- **信息展示**：优化了 API Key 和模型列表的展示布局，支持单行显示更多信息。
- **窗口适配**：调整默认窗口大小以适应新的宽布局。

---

## [2.0.0] - 2025-10-28

### 重大变更
- **浏览器启动重构**：使用 `spawn` 替代 `exec` 启动 Chrome，支持多路径自动检测，显著提升稳定性。
- **应用体积优化**：通过限制语言包、启用 ASAR 压缩和构建优化，体积减少约 60%。
- **生产环境修复**：修复了打包后出现的白屏问题。

### 新增
- **签到功能**：完整实现智能签到检测、一键签到及奖励显示。
- **加油站**：支持配置额外的福利链接。

---

## [1.x] - 历史版本

### 核心功能
- 支持 7 种主流 API 站点类型（New API, One API, Veloera 等）。
- 支持多账号管理、余额查看、模型列表。
- 支持 API Key 管理。
- 支持自动识别和手动添加站点。
