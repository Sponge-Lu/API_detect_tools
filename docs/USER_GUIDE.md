# API Hub Management Tools - 用户使用指南

## 📖 目录

- [简介](#简介)
- [界面设计](#界面设计)
- [核心功能](#核心功能)
  - [多站点管理](#多站点管理)
  - [自动认证与登录](#自动认证与登录)
  - [API Key 管理](#api-key-管理)
  - [模型定价与查询](#模型定价与查询)
  - [签到与福利](#签到与福利)
  - [Token 统计](#token-统计)
  - [数据备份与恢复](#数据备份与恢复)
- [WebDAV 云端备份](#webdav-云端备份)
- [窗口关闭行为](#窗口关闭行为)
- [软件更新](#软件更新)
- [使用场景](#使用场景)
- [常见问题 (FAQ)](#常见问题-faq)

---

## 简介

**API Hub Management Tools** 是一个基于 One API 系列项目的桌面管理客户端。它专为管理和监控多个 API 中转站而设计，提供了从自动认证、余额监控到 API Key 管理的一站式解决方案。

支持的站点类型包括：
- One API (原始项目)
- New API (增强版)
- One Hub / Done Hub (分支版本)
- Veloera (定制版)
- VoAPI / Super-API (高性能版)

---

## 界面设计

### iOS 风格 UI

应用采用 Apple Human Interface Guidelines 设计语言，提供现代化的视觉体验：

- **设计系统**：完整的 iOS 设计系统，包含颜色、字体、间距、圆角、阴影、模糊效果
- **组件库**：IOSButton、IOSCard、IOSInput、IOSModal、IOSTable 等组件
- **图标风格**：统一 1.5px stroke-width，更接近 SF Symbols 风格
- **主题支持**：浅色/深色模式，300ms 平滑过渡
- **响应式布局**：最小支持 1024x768，响应式间距和字体
- **无障碍性**：焦点指示器、键盘导航、ARIA 属性支持
- **性能优化**：GPU 加速、will-change、高性能动画

### 窗口尺寸

- **默认尺寸**：1400×900 像素
- **最小尺寸**：1200×700 像素
- 优化的布局避免水平滚动条问题

---

## 核心功能

### 多站点管理

- **集中管理**：在一个界面中添加和管理无限数量的 API 站点。
- **分组功能**：支持自定义站点分组（如"主力站"、"备用站"、"测试站"）。
  - 拖拽站点卡片到分组标签可快速更改分组。
  - 支持分组排序和筛选。
- **自定义名称**：可以为每个站点设置别名，方便识别。
- **拖拽排序**：通过拖拽自由调整站点在列表中的顺序。
  - 拖拽到页面顶部/底部边缘时自动滚动页面。
- **列排序**：点击表头列标题可按该列排序
  - 支持按站点名、余额、今日消费、Token、请求数、RPM、TPM、模型数、更新时间排序
  - 首次点击降序，再次点击升序，第三次点击取消排序
  - 排序设置自动保存，重启应用后自动恢复
- **站点状态显示**：站点名称前显示状态图标
  - 🟢 绿色圆点（带脉冲动画）= 在线
  - 🔴 红色圆点 = 离线
  - ⚪ 灰色圆点 = 未检测
- **独立自动刷新**：每个站点可单独开启/关闭自动刷新功能
  - 在站点编辑器中配置自动刷新开关和刷新间隔（最小 3 分钟）
  - 站点卡片上的刷新按钮可快速切换开关状态，使用已保存的间隔或默认 5 分钟
  - 开启了 Cloudflare 保护的站点需保持浏览器窗口开启
  - 有站点开启自动刷新时，检测完成后浏览器不会自动关闭

### 自动认证与登录

- **智能添加模式**：
  - 只需输入站点 URL，软件会自动启动内置浏览器。
  - 在浏览器中登录账号后，软件自动捕获认证信息（Cookie/Token）。
  - 无需手动查找 Access Token 或 User ID。
- **手动添加模式**：
  - 针对高级用户，支持直接填写 URL、User ID 和 Access Token。
- **Cloudflare 绕过**：
  - 内置 Cloudflare 验证等待机制，自动处理人机验证页面。
- **智能登录保持**：
  - 自动检测 Session 过期，并在后台尝试刷新或提示重新登录。
- **批量检测登录提醒**：
  - 批量检测时如发现站点未登录，会自动打开浏览器并弹窗提示，等待用户完成登录后再继续获取数据。

### 批量检测体验

- **即时更新**：批量检测时，单个站点完成就立即在列表中更新结果，无需等全部结束。
- **并发可调**：设置中可开启/关闭并发并设置最大并发数（默认 3，1–5 可调），根据机器和网络情况权衡速度与稳定性。
- **超时默认 30s**：超时可在设置中调整，默认 30 秒，适配多数站点的响应时间。
- **浏览器更安全**：调试端口随机化、取消隐藏/后台启动，降低端口冲突和杀软误报概率。

### API Key 管理

- **可视化管理**：在桌面端直接查看、创建、删除 API Key。
- **创建令牌**：
  - 支持设置令牌名称、分组、过期时间和额度限制。
  - 自动适配不同站点类型的创建协议。
- **浏览器模式回退**：
  - 当 API 端口被防火墙拦截时，自动切换到浏览器模式完成操作。
- **浏览器模式优化**：
  - 进入浏览器模式后，后续请求直接在浏览器上下文中执行，减少重复回退延迟。
  - 共享页面并发请求自动串行化，避免偶发的执行上下文错误。

### 模型定价与查询

- **智能定价展示**：
  - 自动区分按量计费（$/1M tokens）和按次计费（$/次）。
  - 根据用户分组自动计算最终价格（包含倍率）。
- **模型列表**：
  - 优先展示站点实际支持的完整模型列表（1000+ 模型）。
  - 支持筛选和搜索模型。
- **全局搜索**
  - 根据关键字全部搜索并显示站点，隐藏没有关键字的站点

### 签到与福利

- **自动签到检测**：
  - 智能识别站点是否支持签到功能。
  - 自动适配不同站点类型的签到 API（Veloera 和 New API）。
  - 显示签到状态（可签到/已签到）。
- **一键签到**：
  - 单个站点点击签到图标即可完成签到并显示获得的奖励金额。
  - 支持浏览器模式绕过 Cloudflare 完成签到。
- **批量一键签到（全部站点）**：
  - 点击顶部日历图标可批量签到所有可签到站点。
  - 自动跳过未认证、未开启签到或当天已签到站点。
  - 完成后会汇总成功/失败结果，并回写站点签到状态与余额缓存。
- **加油站功能**：
  - 支持配置额外的福利链接（如抽奖页面），提供快捷跳转入口。

### Token 统计

- **用量监控**：
  - 实时显示今日 Token 使用量（输入/输出/总量）。
  - 统计今日请求次数。
- **速率监控**：
  - 自动计算 RPM（每分钟请求数）和 TPM（每分钟 Token 数）。

### CLI 兼容性测试

- **CLI 配置检测**：
  - 自动检测本地 CLI 工具的配置状态（Claude Code、Codex、Gemini CLI）
  - Header 区域显示 CLI 配置状态面板，点击可展开查看详情
  - 显示配置来源类型：
    - managed（本应用管理）：配置的 URL 与管理的站点匹配
    - other（其他来源）：配置存在但 URL 不匹配任何管理的站点
    - unconfigured（未配置）：未检测到配置文件
  - 支持手动刷新检测结果
  - 应用 CLI 配置后自动刷新检测状态
- **支持的 CLI 工具**：
  - Claude Code（Anthropic 官方 CLI）
  - Codex（OpenAI CLI）
  - Gemini CLI（Google CLI）
- **启用/禁用 CLI**：
  - 每个 CLI 类型都有独立的启用/禁用开关。
  - 默认状态：Claude Code、Codex、Gemini CLI 均默认启用。
  - 禁用的 CLI 不会显示图标，测试时也会跳过。
  - 启用/禁用与 API Key 和模型配置无关，可独立控制。
- **配置方式**：
  - 在站点列表的"CLI支持"列点击配置按钮。
  - 为每个 CLI 类型选择要使用的 API Key。
  - 分别选择"测试使用模型"和"CLI 使用模型"：
    - 测试使用模型：用于 CLI 兼容性测试，建议选择较新的模型。
    - CLI 使用模型：用于生成配置文件，选择实际使用的模型。
  - Claude Code 只显示 claude* 模型，Codex 只显示 gpt* 模型，Gemini CLI 只显示 gemini* 模型。
- **测试流程**：
  - 配置完成后点击测试按钮开始检测。
  - 仅测试已启用且已配置的 CLI。
  - **Codex 双 API 测试**：同时测试 Chat Completions API 和 Responses API
    - 测试结果显示详细信息：`chat: ✓/✗, responses: ✓/✗`
    - 鼠标悬停 Codex 图标显示详细测试结果
  - **Gemini CLI 双端点测试**：同时测试 Native 和 Proxy 端点
    - Native: Google 原生格式 (`/v1beta/models/{model}:generateContent`) - Gemini CLI 实际使用此格式
    - Proxy: OpenAI 兼容格式 (`/v1/chat/completions`) - 仅供参考
    - 测试结果显示详细信息：`native: ✓/✗, proxy: ✓/✗`
    - 鼠标悬停显示详细状态和使用建议
    - **重要**：Gemini CLI 支持状态仅基于 Native 测试结果（因为 CLI 只使用原生格式）
    - 如果仅 Proxy 通过而 Native 失败，会显示警告提示 CLI 可能无法正常工作
  - 测试结果以图标颜色显示：
    - 彩色 = 支持
    - 深灰色 = 不支持
    - 浅灰色 = 已配置待测试
    - 非常淡 = 未配置
- **自动配置更新**：
  - 测试完成后自动更新 Codex 配置文件中的 `wire_api` 值
  - 根据测试结果自动选择最佳 API（优先 responses，其次 chat）
  - 配置文件包含测试结果注释（如 `# wire_api 测试结果: chat=✗, responses=✓`）
  - Gemini CLI 配置文件包含端点测试结果注释和使用建议
- **生成 CLI 配置文件**：
  - 选择 API Key 和 CLI 使用模型后，配置预览会实时更新。
  - 未选择时显示配置模板，可参考模板格式。
  - 支持 Claude Code、Codex 和 Gemini CLI 配置生成。
  - 生成的配置支持预览和编辑模式切换。
  - 可直接修改配置内容后复制到对应的配置文件路径。
  - Claude Code 配置包含 HTTPS_PROXY 和 HTTP_PROXY 代理设置。
  - 支持重置功能：点击"重置"按钮可恢复为默认生成的配置（需确认）。
- **应用配置**：
  - 点击"应用"按钮可将配置直接写入对应的配置文件路径。
  - 支持两种应用模式：
    - 合并模式（默认）：只更新相关配置项，保留用户的其他设置（如 MCP 服务器配置）
    - 覆盖模式：完全替换现有配置文件
  - 支持 JSON、TOML 和 .env 文件的智能合并。
  - 应用 Claude Code 配置后，会提醒用户重启 IDE 编辑器。
- **配置持久化**：
  - CLI 配置保存在站点配置中，备份时不会丢失。
- **自定义 CLI 配置（v2.1.15+）**：
  - 支持单独维护 Base URL + API Key 的自定义配置（不依赖站点检测结果）。
  - 可从 `/v1/models` 拉取模型列表并搜索选择模型。
  - 配置可一键应用到 Claude Code、Codex、Gemini CLI。

### Linux Do Credit 积分查询

- **积分监控**：
  - 查询 credit.linux.do 的积分数据（基准值、余额、收入、支出等）。
  - 不再依赖 linux.do 论坛积分接口，减少 Cloudflare 验证和限流影响。
- **用户信息展示**：
  - 头像和昵称：显示用户头像和昵称，鼠标悬停显示用户名。
  - 信任等级徽章：显示用户在论坛的信任等级（新用户/基本用户/成员/活跃用户/领导者）。
  - 收支信息：总收入、总支出、可用余额一目了然。
  - 详情面板（可折叠）：支付评分、支付等级、剩余配额、每日限额、支付密钥状态。
- **展开详情**：
  - 三栏布局展示：交易记录、收入统计、支出统计。
  - 每日收入/支出条形图，显示最近 7 天的数据。
  - 交易记录列表，显示订单名称、金额、状态。
  - 支持刷新各个统计卡片的数据。
- **LDC 充值功能**：
  - 在展开详情底部提供快捷充值入口。
  - 选择支持 LDC 支付的站点，输入充值金额。
  - 自动计算所需 LDC 积分（充值金额 × 兑换比例）。
  - 显示当前可用余额，余额不足时显示警告。
  - 点击充值按钮后在浏览器中打开支付页面完成支付。
  - LDC 兑换比例接口自动回退到浏览器模式，避免 403 错误。
- **数据加载优化**：
  - 登录时一次性获取所有数据（用户信息、每日统计、交易记录）。
  - 数据缓存到本地，展开详情时直接使用缓存，无需重新获取。
  - 刷新流程仅在 credit.linux.do 会话内完成，减少跨域和跳转带来的不稳定性。
- **使用方式**：
  - 点击界面中的 Credit 按钮打开积分面板。
  - 首次使用需要登录 Linux Do 账号。
  - 登录成功后自动获取并显示积分数据。
  - 点击"展开详情"查看每日统计和交易记录。
- **技术说明**：
  - credit.linux.do 存在 Cloudflare 保护，系统通过浏览器自动化在同一会话中获取数据。
  - 登录状态会自动保持，无需重复登录。

### 数据备份与恢复

- **自动备份**：
  - 配置文件自动备份到用户主目录 `~/.api-hub-management-tools/`。
  - 卸载应用不会丢失配置。
- **一键恢复**：
  - 提供可视化的备份选择对话框，可随时恢复到任意历史状态。
  - 恢复后立即刷新数据，无需重启应用。

### WebDAV 云端备份

- **云端同步**：
  - 支持将配置备份到 WebDAV 云存储服务（如坚果云、NextCloud、Synology NAS）。
  - 实现跨设备配置同步和云端数据保护。
- **配置方式**：
  - 在设置面板中启用 WebDAV 备份功能。
  - 填写服务器地址、用户名、应用密码和远程路径。
  - 点击"测试连接"验证配置是否正确。
- **备份管理**：
  - 点击"管理云端备份"打开备份管理对话框。
  - 支持上传新备份、查看备份列表、恢复和删除备份。
  - 备份文件自动按时间戳命名，格式为 `config_YYYY-MM-DD_HH-mm-ss.json`。
- **自动清理**：
  - 可设置最大备份数量（默认 10 个）。
  - 超过限制时自动删除最旧的备份。

### 窗口关闭行为

- **关闭行为选择**：
  - 点击窗口关闭按钮时，可选择"退出应用"或"最小化到托盘"。
  - 首次关闭时弹出选择对话框。
  - 支持"记住我的选择"，下次关闭时自动执行。
- **系统托盘**：
  - 最小化到托盘后，应用在系统托盘区域显示图标。
  - 点击托盘图标可恢复窗口。
  - 右键托盘图标显示菜单（显示窗口、退出）。
- **设置面板配置**：
  - 在设置面板中可随时更改关闭行为偏好。
  - 三个选项：每次询问、直接退出、最小化到托盘。

### 软件更新

- **自动检查更新**：
  - 应用启动时自动在后台检查是否有新版本。
  - 可在设置中开启或关闭自动检查功能。
- **手动检查更新**：
  - 在设置面板中点击"检查更新"按钮手动检查。
  - 同时显示最新正式版本和预发布版本信息。
- **预发布版本支持**：
  - 可选择是否接收 Beta、Alpha 等预发布版本的更新通知。
  - 预发布版本用橙色标识，正式版本用绿色标识。
- **更新详情**：
  - 点击"查看详情"可查看版本更新说明、发布日期等信息。
- **应用内下载与安装（v2.1.18+）**：
  - 点击"立即下载"会打开应用内下载面板，展示更新说明、下载进度和速度。
  - 下载过程中可取消；下载完成后可直接点击"立即安装"启动安装流程。

---

## 使用场景

### 1. API 聚合管理
如果你同时使用多个 API 中转站（如为了分散风险或利用不同站点的优势模型），本工具可以帮助你统一监控所有站点的余额和状态，无需分别登录每个网站。

### 2. 开发者调试
开发者可以利用本工具快速创建测试用的 API Key，查看模型定价，以及监控 API 调用速率。

### 3. 福利领取
对于支持每日签到的站点，本工具提供了一键签到功能，帮助你轻松领取每日额度，避免遗漏。

---

## 常见问题 (FAQ)

### Q: 为什么添加站点时浏览器打开了但没有自动关闭？
**A**: 
1. 请确保你已经完成了登录操作。
2. 如果遇到 Cloudflare 验证，请手动完成人机验证。
3. 软件会等待直到成功获取用户信息，如果长时间无反应，请检查网络连接或尝试手动模式。

### Q: “模型接口请求失败：Certificate has expired” 怎么办？
**A**:
1. 站点的 HTTPS 证书可能已过期或不受信任，请联系站点管理员更新证书。
2. 批量检测时遇到证书错误会直接提示，不会长时间超时，可先检测其它站点。
3. 若本地网络拦截导致证书问题，尝试切换网络或在可信网络下再试。

### Q: "API Key 创建失败" 是什么原因？
**A**:
1. 检查你的账号权限，部分站点禁止普通用户创建令牌。
2. 可能是站点开启了严格的防火墙（如 Cloudflare），软件会自动尝试浏览器模式，请留意弹出的浏览器窗口。

### Q: 数据显示不准确或延迟？
**A**:
1. 点击站点卡片右侧的刷新按钮手动更新数据。
2. 检查网络连接是否正常。
3. 如果站点 API 响应缓慢，可能会导致超时，请稍后重试。

### Q: 如何迁移数据到新电脑？
**A**:
1. 在旧电脑上使用"导出配置"功能生成 JSON 文件。
2. 在新电脑上安装软件，使用"导入配置"功能加载文件。
3. 或者直接复制 `~/.api-hub-management-tools/` 目录下的备份文件。
4. 推荐使用 WebDAV 云端备份功能，在新电脑上直接从云端恢复配置。

### Q: WebDAV 备份连接失败怎么办？
**A**:
1. 检查服务器地址是否正确，必须以 `http://` 或 `https://` 开头。
2. 确认用户名和密码正确，建议使用应用专用密码而非账户密码。
3. 检查远程路径是否存在，软件会自动创建不存在的目录。
4. 如果使用坚果云，请在安全设置中生成应用密码。

### Q: WebDAV 配置保存后丢失了怎么办？
**A**:
1. 此问题已在 v2.1.2 版本修复。
2. 如果仍遇到问题，请确保使用最新版本。
3. WebDAV 配置现在会在其他操作（如拖拽站点排序）时自动保留。

### Q: 支持哪些操作系统？
**A**:
目前支持 Windows 和 macOS。Linux 版本理论上支持但未经充分测试。
